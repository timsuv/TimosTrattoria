@using RestautantMvc.ViewModels
@model BookingsViewModel

<div class="d-flex justify-content-between align-items-center mb-4">
    <h3>Manage Bookings</h3>
    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#createBookingModal">
        <i class="bi bi-plus-circle me-2"></i>Add New Booking
    </button>
</div>


@if (Model.Bookings.Any())
{
    <div class="table-responsive">
        <table class="table table-custom table-hover">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Customer</th>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Guests</th>
                    <th>Table</th>
                    <th>Contact</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var booking in Model.Bookings)
                {
                    <tr>
                        <td>@booking.BookingId</td>
                        <td>@booking.CustomerName</td>
                        <td>@booking.BookingDate.ToString("MMM dd, yyyy")</td>
                        <td>@booking.BookingTime.ToString(@"hh\:mm") - @booking.EndTime.ToString(@"hh\:mm")</td>
                        <td>@booking.NumberOfGuests</td>
                        <td>
                            <span class="badge bg-info">Table @booking.TableNumber</span>
                        </td>
                        <td>
                            <small>
                                @booking.CustomerEmail<br />
                                @booking.CustomerPhone
                            </small>
                        </td>
                        <td>
                            <div class="d-flex gap-1">
                                <!-- update table btn -->
                                <button type="button"
                                        class="btn btn-sm btn-warning"
                                        data-bs-toggle="modal"
                                        data-bs-target="#updateBookingModal-@booking.BookingId"
                                        title="Change Table">
                                    <i class="bi bi-pencil-square"></i>
                                </button>

                                <!-- delete booking -->
                                <form asp-action="DeleteBooking" asp-controller="Admin" method="post"
                                      onsubmit="return confirm('Are you sure you want to delete this booking?');"
                                      class="d-inline">
                                    <input type="hidden" name="id" value="@booking.BookingId" />
                                    <button type="submit" class="btn btn-sm btn-danger" title="Delete">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </form>
                            </div>

                            <!-- update modal -->
                            <div class="modal fade modal-blur" id="updateBookingModal-@booking.BookingId" tabindex="-1">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <form asp-action="UpdateBookingTable" asp-controller="Admin" method="post">
                                            <div class="modal-header bg-primary-brand text-light-brand">
                                                <h5 class="modal-title">Change Table - Booking #@booking.BookingId</h5>
                                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                                            </div>
                                            <div class="modal-body">
                                                <input type="hidden" name="bookingId" value="@booking.BookingId" />
                                                <div class="mb-3">
                                                    <label class="form-label">Current</label>
                                                    <p>Table @booking.TableNumber (Cap: @booking.TableCapacity)</p>
                                                </div>
                                                <div class="mb-3">
                                                    <label class="form-label">Select New Date</label>
                                                    <input type="date" class="form-control" name="newDate"
                                                           value="@booking.BookingDate.ToString("yyyy-MM-dd")" required />
                                                </div>

                                                <div class="mb-3">
                                                    <label class="form-label">Select New Time</label>
                                                    <input type="time" class="form-control" name="newTime"
                                                           value="@booking.BookingTime.ToString(@"hh\:mm")" required />
                                                </div>

                                                <div class="mb-3">
                                                    <label class="form-label">Select The Number Of Guests</label>
                                                    <input type="number" class="form-control" name="newNumberOfGuests"
                                                           value="@booking.NumberOfGuests" required />

                                                </div>

                                                <div class="mb-3">
                                                    <label class="form-label">Select New Table</label>
                                                    <select class="form-select" name="tableId" required>
                                                        <option value="">Choose...</option>
                                                        @foreach (var table in Model.Tables)
                                                        {
                                                            <option value="@table.TableId"
                                                                    selected="@(table.TableId == booking.TableId ? "selected" : null)">
                                                                Table @table.TableNumber (Cap: @table.Capacity)
                                                            </option>
                                                        }
                                                    </select>
                                                </div>

                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                                <button type="submit" class="btn btn-primary">Update</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- create booking modal -->
    <div class="modal fade modal-blur" id="createBookingModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <form asp-action="CreateBooking" asp-controller="Admin" method="post">
                    <div class="modal-header bg-success text-light">
                        <h5 class="modal-title">Create New Booking</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <!-- customer info -->
                        <h6 class="mb-3 text-muted">Customer Information</h6>
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label for="customerName" class="form-label">Customer Name *</label>
                                <input type="text"
                                       class="form-control"
                                       id="customerName"
                                       name="CustomerName"
                                       placeholder="John Doe"
                                       required />
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="customerEmail" class="form-label">Email *</label>
                                <input type="email"
                                       class="form-control"
                                       id="customerEmail"
                                       name="CustomerEmail"
                                       placeholder="john@example.com"
                                       required />
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="customerPhone" class="form-label">Phone *</label>
                                <input type="tel"
                                       class="form-control"
                                       id="customerPhone"
                                       name="CustomerPhone"
                                       placeholder="+46 70 123 4567"
                                       required />
                            </div>
                        </div>

                        <hr class="my-3" />

                        <!-- booking details -->
                        <h6 class="mb-3 text-muted">Booking Details</h6>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="bookingDate" class="form-label">Booking Date *</label>
                                <input type="date"
                                       class="form-control"
                                       id="bookingDate"
                                       name="BookingDate"
                                       min="@DateTime.Today.ToString("yyyy-MM-dd")"
                                       required />
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="bookingTime" class="form-label">Booking Time *</label>
                                <input type="time"
                                       class="form-control"
                                       id="bookingTime"
                                       name="BookingTime"
                                       min="11:00"
                                       max="22:00"
                                       required />
                                <small class="text-muted">Restaurant hours: 11:00 - 22:00</small>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="numberOfGuests" class="form-label">Number of Guests *</label>
                                <input type="number"
                                       class="form-control"
                                       id="numberOfGuests"
                                       name="NumberOfGuests"
                                       min="1"
                                       max="20"
                                       placeholder="2"
                                       required />
                                <small class="text-muted">Maximum 20 guests per booking</small>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="tableId" class="form-label">Select Table *</label>
                                <select class="form-select"
                                        id="tableId"
                                        name="TableId"
                                        required>
                                    <option value="">Choose a table...</option>
                                    @foreach (var table in Model.Tables)
                                    {
                                        <option value="@table.TableId">
                                            Table @table.TableNumber (Capacity: @table.Capacity)
                                        </option>
                                    }
                                </select>
                                <small class="text-muted">Select based on guest count</small>
                            </div>
                        </div>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-success">Create Table</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
}
else
{
    <div class="text-center py-5">
        <i class="bi bi-calendar-x" style="font-size: 3rem;"></i>
        <p class="text-muted mt-3">No bookings found.</p>
    </div>
}